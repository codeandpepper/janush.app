import { Stack, StackProps } from "aws-cdk-lib";
import { Construct } from "constructs";

import { EnvName } from "../enums/EnvName";
import { CognitoCdkConstruct } from "./authentication/cognitoCdkConstruct";
import { CognitoAppsyncConstruct } from "./cognitoAppsyncConstruct/cognitoAppsyncConstruct";

interface SingleEnvironmentProps {
  envName: EnvName;
}

export class JanushAutoGeneratedAppStack extends Stack {
  constructor(
    scope: Construct,
    id: string,
    { envName, ...stackProps }: StackProps & SingleEnvironmentProps
  ) {
    super(scope, id, stackProps);
    // ========================================================================
    // Authentication: Amazon Cognito
    // ========================================================================

    const cognitoCdkConstruct = new CognitoCdkConstruct(
      this,
      `${envName}-CognitoUserPool`,
      {
        envName,
      }
    );

    // ========================================================================
    // Users Management: AppSync
    // ========================================================================
    new CognitoAppsyncConstruct(this, `${envName}-CognitoAppSync`, {
      userPool: cognitoCdkConstruct.userPool,
    });
  }
}
